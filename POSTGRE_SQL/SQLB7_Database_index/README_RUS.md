## _I improved my SQL Query! Please, provide proof!_

Ð’ ÑÑ‚Ð¾Ð¼ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ðµ Ñ‚Ñ‹ Ð¾ÑÐ²Ð¾Ð¸ÑˆÑŒ Ð¿Ñ€Ð¾Ð´Ð²Ð¸Ð½ÑƒÑ‚Ñ‹Ðµ Ñ‚ÐµÑ…Ð½Ð¸ÐºÐ¸ Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹ Ñ Ð¸Ð½Ð´ÐµÐºÑÐ°Ð¼Ð¸ PostgreSQL: Ñ‚Ñ‹ Ð½Ð°ÑƒÑ‡Ð¸ÑˆÑŒÑÑ ÑÐ¾Ð·Ð´Ð°Ð²Ð°Ñ‚ÑŒ Ñ€Ð°Ð·Ð½Ñ‹Ðµ Ñ‚Ð¸Ð¿Ñ‹ Ð¸Ð½Ð´ÐµÐºÑÐ¾Ð², Ð°Ð½Ð°Ð»Ð¸Ð·Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð·Ð°Ð¿Ñ€Ð¾ÑÑ‹ Ð¸ Ð¾Ð¿Ñ‚Ð¸Ð¼Ð¸Ð·Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð¸Ñ… Ñ‚Ð°Ðº, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð²ÑÐµ Ñ€Ð°Ð±Ð¾Ñ‚Ð°Ð»Ð¾ Ð¼Ð°ÐºÑÐ¸Ð¼Ð°Ð»ÑŒÐ½Ð¾ Ð±Ñ‹ÑÑ‚Ñ€Ð¾.

Ð­Ñ‚Ð¸ Ð½Ð°Ð²Ñ‹ÐºÐ¸ Ð¿Ñ€Ð¸Ð³Ð¾Ð´ÑÑ‚ÑÑ, ÐºÐ¾Ð³Ð´Ð° Ð½ÑƒÐ¶Ð½Ð¾ Ð±ÑƒÐ´ÐµÑ‚ ÑƒÑÐºÐ¾Ñ€Ð¸Ñ‚ÑŒ Ð¼ÐµÐ´Ð»ÐµÐ½Ð½Ñ‹Ðµ Ð¾Ñ‚Ñ‡ÐµÑ‚Ñ‹, ÑÐ½Ð¸Ð·Ð¸Ñ‚ÑŒ Ð½Ð°Ð³Ñ€ÑƒÐ·ÐºÑƒ Ð½Ð° ÑÐµÑ€Ð²ÐµÑ€, Ð³Ð°Ñ€Ð°Ð½Ñ‚Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ ÑƒÐ½Ð¸ÐºÐ°Ð»ÑŒÐ½Ð¾ÑÑ‚ÑŒ Ð´Ð°Ð½Ð½Ñ‹Ñ… (Ð½Ð°Ð¿Ñ€Ð¸Ð¼ÐµÑ€, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð² Ð¾Ð´Ð½Ð¾Ð¼ Ñ€ÐµÑÑ‚Ð¾Ñ€Ð°Ð½Ðµ Ð½Ðµ Ð±Ñ‹Ð»Ð¾ Ð´Ð²ÑƒÑ… Ð¿Ð¸Ñ†Ñ† Ñ Ð¾Ð´Ð¸Ð½Ð°ÐºÐ¾Ð²Ñ‹Ð¼ Ð½Ð°Ð·Ð²Ð°Ð½Ð¸ÐµÐ¼) Ð¸Ð»Ð¸ Ð¿Ñ€Ð¾ÑÑ‚Ð¾ ÑÐ´ÐµÐ»Ð°Ñ‚ÑŒ Ñ‚Ð°Ðº, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ð¸ Ñ‚Ð²Ð¾ÐµÐ³Ð¾ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ Ð½Ðµ Ð¶Ð´Ð°Ð»Ð¸ Ð»Ð¸ÑˆÐ½ÑŽÑŽ ÑÐµÐºÑƒÐ½Ð´Ñƒ Ñ‚Ð°Ð¼, Ð³Ð´Ðµ Ð¼Ð¾Ð¶Ð½Ð¾ Ð¾Ñ‚Ð²ÐµÑ‚Ð¸Ñ‚ÑŒ Ð¼Ð³Ð½Ð¾Ð²ÐµÐ½Ð½Ð¾.

ðŸ’¡ [ÐÐ°Ð¶Ð¼Ð¸ ÑÑŽÐ´Ð°](https://new.oprosso.net/p/4cb31ec3f47a4596bc758ea1861fb624) **Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð¿Ð¾Ð´ÐµÐ»Ð¸Ñ‚ÑŒÑÑ Ñ Ð½Ð°Ð¼Ð¸ Ð¾Ð±Ñ€Ð°Ñ‚Ð½Ð¾Ð¹ ÑÐ²ÑÐ·ÑŒÑŽ Ð½Ð° ÑÑ‚Ð¾Ñ‚ Ð¿Ñ€Ð¾ÐµÐºÑ‚**. Ð­Ñ‚Ð¾ Ð°Ð½Ð¾Ð½Ð¸Ð¼Ð½Ð¾ Ð¸ Ð¿Ð¾Ð¼Ð¾Ð¶ÐµÑ‚ Ð½Ð°ÑˆÐµÐ¹ ÐºÐ¾Ð¼Ð°Ð½Ð´Ðµ ÑÐ´ÐµÐ»Ð°Ñ‚ÑŒ Ð¾Ð±ÑƒÑ‡ÐµÐ½Ð¸Ðµ Ð»ÑƒÑ‡ÑˆÐµ. Ð ÐµÐºÐ¾Ð¼ÐµÐ½Ð´ÑƒÐµÐ¼ Ð·Ð°Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÑŒ Ð¾Ð¿Ñ€Ð¾Ñ ÑÑ€Ð°Ð·Ñƒ Ð¿Ð¾ÑÐ»Ðµ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ñ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð°.

## Ð¡Ð¾Ð´ÐµÑ€Ð¶Ð°Ð½Ð¸Ðµ

- [ÐšÐ°Ðº ÑƒÑ‡Ð¸Ñ‚ÑŒÑÑ Ð² Â«Ð¨ÐºÐ¾Ð»Ðµ 21Â»](#ÐºÐ°Ðº-ÑƒÑ‡Ð¸Ñ‚ÑŒÑÑ-Ð²-ÑˆÐºÐ¾Ð»Ðµ-21)
- [Chapter I](#chapter-i)
- [Ð’Ð²ÐµÐ´ÐµÐ½Ð¸Ðµ](#Ð²Ð²ÐµÐ´ÐµÐ½Ð¸Ðµ)
- [Chapter II](#chapter-ii)
- [Ð ÐµÐºÐ¾Ð¼ÐµÐ½Ð´Ð°Ñ†Ð¸Ð¸ Ðº Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸ÑŽ ÑÑ‚Ð¾Ð³Ð¾ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð°](#Ñ€ÐµÐºÐ¾Ð¼ÐµÐ½Ð´Ð°Ñ†Ð¸Ð¸-Ðº-Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸ÑŽ-ÑÑ‚Ð¾Ð³Ð¾-Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð°)
- [Chapter III](#chapter-iii)
- [Ð—Ð°Ð´Ð°Ð½Ð¸Ðµ 00 â€” Letâ€™s create indexes for every foreign key](#Ð·Ð°Ð´Ð°Ð½Ð¸Ðµ-00--lets-create-indexes-for-every-foreign-key)
- [Ð—Ð°Ð´Ð°Ð½Ð¸Ðµ 01 â€” How to see that index works?](#Ð·Ð°Ð´Ð°Ð½Ð¸Ðµ-01--how-to-see-that-index-works)
- [Ð—Ð°Ð´Ð°Ð½Ð¸Ðµ 02 â€” Formula is in the index. Is it Ok?](#Ð·Ð°Ð´Ð°Ð½Ð¸Ðµ-02--formula-is-in-the-index-is-it-ok)
- [Ð—Ð°Ð´Ð°Ð½Ð¸Ðµ 03 â€” Multicolumn index for our goals](#Ð·Ð°Ð´Ð°Ð½Ð¸Ðµ-03--multicolumn-index-for-our-goals)
- [Ð—Ð°Ð´Ð°Ð½Ð¸Ðµ 04 â€” Uniqueness for data](#Ð·Ð°Ð´Ð°Ð½Ð¸Ðµ-04--uniqueness-for-data)
- [Ð—Ð°Ð´Ð°Ð½Ð¸Ðµ 05 â€” Partial uniqueness for data](#Ð·Ð°Ð´Ð°Ð½Ð¸Ðµ-05--partial-uniqueness-for-data)
- [Ð—Ð°Ð´Ð°Ð½Ð¸Ðµ 06 â€” Letâ€™s make performance improvement](#Ð·Ð°Ð´Ð°Ð½Ð¸Ðµ-06--lets-make-performance-improvement)

## ÐšÐ°Ðº ÑƒÑ‡Ð¸Ñ‚ÑŒÑÑ Ð² Â«Ð¨ÐºÐ¾Ð»Ðµ 21Â» 

* Ð—Ð´ÐµÑÑŒ Ñ‚ÐµÐ±Ñ Ð¶Ð´ÐµÑ‚ ÑƒÐ½Ð¸ÐºÐ°Ð»ÑŒÐ½Ñ‹Ð¹ Ð¾Ð±Ñ€Ð°Ð·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ð¹ Ð¾Ð¿Ñ‹Ñ‚ Ñ Ð±Ð¾Ð»ÑŒÑˆÐ¸Ð¼ ÐºÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾Ð¼ ÑÐ²Ð¾Ð±Ð¾Ð´Ñ‹. Ð¢Ñ‹ Ð¿Ð¾Ð»ÑƒÑ‡Ð°ÐµÑˆÑŒ Ð·Ð°Ð´Ð°Ñ‡Ñƒ Ð¸ ÑÐ°Ð¼Ð¾ÑÑ‚Ð¾ÑÑ‚ÐµÐ»ÑŒÐ½Ð¾ Ð¸Ñ‰ÐµÑˆÑŒ Ð¿ÑƒÑ‚Ð¸ Ñ€ÐµÑˆÐµÐ½Ð¸Ñ, Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÑ Ð»ÑŽÐ±Ñ‹Ðµ ÑƒÐ´Ð¾Ð±Ð½Ñ‹Ðµ ÑÐ¿Ð¾ÑÐ¾Ð±Ñ‹ Ð¿Ð¾Ð¸ÑÐºÐ° Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ð¸ - Ñ€ÐµÑÑƒÑ€ÑÑ‹ Ð˜Ð½Ñ‚ÐµÑ€Ð½ÐµÑ‚Ð° Ð¸Ð»Ð¸ Ð½ÐµÐ¹Ñ€Ð¾ÑÐµÑ‚Ð¸ (Ð½Ð°Ð¿Ñ€Ð¸Ð¼ÐµÑ€, GigaChat). ÐÐ¾ Ð²Ð½Ð¸Ð¼Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð¾ Ð¾Ñ‚Ð½Ð¾ÑÐ¸ÑÑŒ Ðº ÐºÐ°Ñ‡ÐµÑÑ‚Ð²Ñƒ Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ð¸: Ð¿Ñ€Ð¾Ð²ÐµÑ€ÑÐ¹, Ð´ÑƒÐ¼Ð°Ð¹, Ð°Ð½Ð°Ð»Ð¸Ð·Ð¸Ñ€ÑƒÐ¹, ÑÑ€Ð°Ð²Ð½Ð¸Ð²Ð°Ð¹.  
* Ð’Ð·Ð°Ð¸Ð¼Ð¾Ð¾Ð±ÑƒÑ‡ÐµÐ½Ð¸Ðµ (Peer-to-Peer, P2P) - ÑÑ‚Ð¾ Ð¾Ð±Ð¼ÐµÐ½ Ð·Ð½Ð°Ð½Ð¸ÑÐ¼Ð¸ Ð¸ Ð¾Ð¿Ñ‹Ñ‚Ð¾Ð¼ Ñ Ð´Ñ€ÑƒÐ³Ð¸Ð¼Ð¸ Ð¿Ð¸Ñ€Ð°Ð¼Ð¸, Ð³Ð´Ðµ ÐºÐ°Ð¶Ð´Ñ‹Ð¹ Ð²Ñ‹ÑÑ‚ÑƒÐ¿Ð°ÐµÑ‚ Ð¸ ÑƒÑ‡Ð¸Ñ‚ÐµÐ»ÐµÐ¼, Ð¸ ÑƒÑ‡ÐµÐ½Ð¸ÐºÐ¾Ð¼. Ð¢Ð°ÐºÐ¾Ð¹ Ð¿Ð¾Ð´Ñ…Ð¾Ð´ Ð¿Ð¾Ð·Ð²Ð¾Ð»ÑÐµÑ‚ Ð³Ð»ÑƒÐ±Ð¶Ðµ Ð¿Ð¾Ð½ÑÑ‚ÑŒ Ð¼Ð°Ñ‚ÐµÑ€Ð¸Ð°Ð», ÑƒÑ‡Ð°ÑÑŒ Ð´Ñ€ÑƒÐ³ Ñƒ Ð´Ñ€ÑƒÐ³Ð°.  
* Ð§ÑƒÐ²ÑÑ‚Ð²ÑƒÐ¹ ÑÐµÐ±Ñ ÑÐ²Ð¾Ð±Ð¾Ð´Ð½Ð¾ Ð¸ Ð¿Ñ€Ð¾ÑÐ¸ Ð¾ Ð¿Ð¾Ð¼Ð¾Ñ‰Ð¸ - Ð²Ð¾ÐºÑ€ÑƒÐ³ Ñ‚ÐµÐ±Ñ Ñ‚Ðµ, ÐºÑ‚Ð¾ Ñ‚Ð¾Ð¶Ðµ Ð²Ð¿ÐµÑ€Ð²Ñ‹Ðµ Ð¿Ñ€Ð¾Ñ…Ð¾Ð´ÑÑ‚ ÑÑ‚Ð¾Ñ‚ Ð¿ÑƒÑ‚ÑŒ. Ð”ÐµÐ»Ð¸ÑÑŒ ÑÐ²Ð¾Ð¸Ð¼ Ð¾Ð¿Ñ‹Ñ‚Ð¾Ð¼ Ð¸ Ð¸Ð´ÐµÑÐ¼Ð¸ Ñ Ð´Ñ€ÑƒÐ³Ð¸Ð¼Ð¸. ÐŸÑ€Ð¸ÑÐ¾ÐµÐ´Ð¸Ð½ÑÐ¹ÑÑ Ðº RocketChat, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð±Ñ‹Ñ‚ÑŒ Ð² ÐºÑƒÑ€ÑÐµ Ð²ÑÐµÑ… Ð½Ð¾Ð²Ð¾ÑÑ‚ÐµÐ¹ Ð¾Ñ‚ Ð½Ð°ÑˆÐµÐ³Ð¾ ÑÐ¾Ð¾Ð±Ñ‰ÐµÑÑ‚Ð²Ð°.  
* Ð¢Ð²Ð¾Ðµ Ð¾Ð±ÑƒÑ‡ÐµÐ½Ð¸Ðµ Ð½Ðµ Ð±ÑƒÐ´ÐµÑ‚ Ð¸Ð¼ÐµÑ‚ÑŒ Ð½Ð¸ÐºÐ°ÐºÐ¾Ð³Ð¾ ÑÐ¼Ñ‹ÑÐ»Ð°, ÐµÑÐ»Ð¸ Ñ‚Ñ‹ Ð±ÑƒÐ´ÐµÑˆÑŒ ÐºÐ¾Ð¿Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ñ‡ÑƒÐ¶Ð¸Ðµ Ñ€ÐµÑˆÐµÐ½Ð¸Ñ. Ð•ÑÐ»Ð¸ Ð¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑˆÑŒÑÑ Ð¿Ð¾Ð¼Ð¾Ñ‰ÑŒÑŽ Ð´Ñ€ÑƒÐ³Ð¸Ñ… - Ð²ÑÐµÐ³Ð´Ð° Ñ€Ð°Ð·Ð±Ð¸Ñ€Ð°Ð¹ÑÑ Ð´Ð¾ ÐºÐ¾Ð½Ñ†Ð°, Ð¿Ð¾Ñ‡ÐµÐ¼Ñƒ, ÐºÐ°Ðº Ð¸ Ð·Ð°Ñ‡ÐµÐ¼. ÐÐµ Ð±Ð¾Ð¹ÑÑ Ð¾ÑˆÐ¸Ð±Ð¸Ñ‚ÑŒÑÑ.  
* ÐšÐ°Ð¶ÐµÑ‚ÑÑ, Ñ‡Ñ‚Ð¾ Ð·Ð°Ð´Ð°Ñ‡Ð° Ð½ÐµÐ²Ñ‹Ð¿Ð¾Ð»Ð½Ð¸Ð¼Ð°? Ð¡Ð´ÐµÐ»Ð°Ð¹ Ð¿ÐµÑ€ÐµÑ€Ñ‹Ð², Ð¿Ñ€Ð¾Ð²ÐµÑ‚Ñ€Ð¸ÑÑŒ, Ð¿ÐµÑ€ÐµÐ·Ð°Ð³Ñ€ÑƒÐ·Ð¸ Ð³Ð¾Ð»Ð¾Ð²Ñƒ - ÑÑ‚Ð¾ Ð¿Ð¾Ð¼Ð¾Ð³Ð°Ð»Ð¾ Ð¼Ð½Ð¾Ð³Ð¸Ð¼. Ð’Ð¾Ð·Ð¼Ð¾Ð¶Ð½Ð¾, Ð¿Ð¾ÑÐ»Ðµ ÑÑ‚Ð¾Ð³Ð¾ Ñ€ÐµÑˆÐµÐ½Ð¸Ðµ Ð¿Ñ€Ð¸Ð´ÐµÑ‚ ÑÐ°Ð¼Ð¾ ÑÐ¾Ð±Ð¾Ð¹.  
* Ð’Ð°Ð¶ÐµÐ½ Ð½Ðµ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚ Ð¾Ð±ÑƒÑ‡ÐµÐ½Ð¸Ñ, Ð½Ð¾ Ð¸ ÑÐ°Ð¼ Ð¿Ñ€Ð¾Ñ†ÐµÑÑ. ÐÑƒÐ¶Ð½Ð¾ Ð½Ðµ Ð¿Ñ€Ð¾ÑÑ‚Ð¾ Ñ€ÐµÑˆÐ¸Ñ‚ÑŒ Ð·Ð°Ð´Ð°Ñ‡Ñƒ, Ð° Ð¿Ð¾Ð½ÑÑ‚ÑŒ, ÐšÐÐš ÐµÐµ Ñ€ÐµÑˆÐ¸Ñ‚ÑŒ.

ÐšÐ°Ðº Ñ€Ð°Ð±Ð¾Ñ‚Ð°Ñ‚ÑŒ Ñ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð¾Ð¼:

* ÐŸÐµÑ€ÐµÐ´ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸ÐµÐ¼ Ð¿Ñ€Ð¾ÐµÐºÑ‚ Ð½ÐµÐ¾Ð±Ñ…Ð¾Ð´Ð¸Ð¼Ð¾ ÑÐºÐ»Ð¾Ð½Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ñ GitLab Ð² Ð¾Ð´Ð½Ð¾Ð¸Ð¼ÐµÐ½Ð½Ñ‹Ð¹ Ñ€ÐµÐ¿Ð¾Ð·Ð¸Ñ‚Ð¾Ñ€Ð¸Ð¹.  
* Ð’ÑÐµ Ñ„Ð°Ð¹Ð»Ñ‹ Ð½ÐµÐ¾Ð±Ñ…Ð¾Ð´Ð¸Ð¼Ð¾ ÑÐ¾Ð·Ð´Ð°Ð²Ð°Ñ‚ÑŒ Ð² Ð¿Ð°Ð¿ÐºÐµ *src/* ÑÐºÐ»Ð¾Ð½Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ð¾Ð³Ð¾ Ñ€ÐµÐ¿Ð¾Ð·Ð¸Ñ‚Ð¾Ñ€Ð¸Ñ.  
* ÐŸÐ¾ÑÐ»Ðµ ÐºÐ»Ð¾Ð½Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð° Ð½ÐµÐ¾Ð±Ñ…Ð¾Ð´Ð¸Ð¼Ð¾ ÑÐ¾Ð·Ð´Ð°Ñ‚ÑŒ Ð²ÐµÑ‚ÐºÑƒ develop Ð¸ Ð²ÐµÑÑ‚Ð¸ Ñ€Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚ÐºÑƒ Ð² Ð½ÐµÐ¹. ÐŸÐ¾ÑÐ»Ðµ ÑÑ‚Ð¾Ð³Ð¾ Ð¿ÑƒÑˆÐ¸Ñ‚ÑŒ Ð² GitLab Ñ‚Ð°ÐºÐ¶Ðµ Ð½ÑƒÐ¶Ð½Ð¾ Ð²ÐµÑ‚ÐºÑƒ develop.  
* Ð’ Ñ‚Ð²Ð¾ÐµÐ¹ Ð´Ð¸Ñ€ÐµÐºÑ‚Ð¾Ñ€Ð¸Ð¸ Ð½Ðµ Ð´Ð¾Ð»Ð¶Ð½Ð¾ Ð±Ñ‹Ñ‚ÑŒ Ð¸Ð½Ñ‹Ñ… Ñ„Ð°Ð¹Ð»Ð¾Ð², ÐºÑ€Ð¾Ð¼Ðµ Ñ‚ÐµÑ…, Ñ‡Ñ‚Ð¾ Ð¾Ð±Ð¾Ð·Ð½Ð°Ñ‡ÐµÐ½Ñ‹ Ð² Ð·Ð°Ð´Ð°Ð½Ð¸ÑÑ….

## Chapter I
## Ð’Ð²ÐµÐ´ÐµÐ½Ð¸Ðµ

![D05_01](misc/images/D05_01.png)

ÐšÐ°Ðº Ð¸Ð½Ð´ÐµÐºÑÐ¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ ÑƒÑÐºÐ¾Ñ€ÑÐµÑ‚ Ñ€Ð°Ð±Ð¾Ñ‚Ñƒ? ÐŸÐ¾Ñ‡ÐµÐ¼Ñƒ Ð¾Ð´Ð½Ð° Ð¸ Ñ‚Ð° Ð¶Ðµ SQL-Ð·Ð°Ð¿Ñ€Ð¾Ñ Ñ Ð¸Ð½Ð´ÐµÐºÑÐ¾Ð¼ Ð¸ Ð±ÐµÐ· Ð¸Ð½Ð´ÐµÐºÑÐ° Ð¸Ð¼ÐµÐµÑ‚ Ñ€Ð°Ð·Ð½Ð¾Ðµ ÐºÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ TPS (Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ð¹ Ð² ÑÐµÐºÑƒÐ½Ð´Ñƒ)? 

ÐÐ° ÑÐ°Ð¼Ð¾Ð¼ Ð´ÐµÐ»Ðµ, Ñ Â«Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒÑÐºÐ¾Ð¹ Ñ‚Ð¾Ñ‡ÐºÐ¸ Ð·Ñ€ÐµÐ½Ð¸ÑÂ» Ð¸Ð½Ð´ÐµÐºÑ - ÑÑ‚Ð¾ Ð¿Ñ€Ð¾ÑÑ‚Ð¾ Â«Ñ‡ÐµÑ€Ð½Ñ‹Ð¹ ÑÑ‰Ð¸ÐºÂ» Ñ Ð¼Ð°Ð³Ð¸ÐµÐ¹ Ð²Ð½ÑƒÑ‚Ñ€Ð¸. Ð¡ Â«Ð¼Ð°Ñ‚ÐµÐ¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¾Ð¹ Ñ‚Ð¾Ñ‡ÐºÐ¸ Ð·Ñ€ÐµÐ½Ð¸ÑÂ» Ð¸Ð½Ð´ÐµÐºÑ - ÑÑ‚Ð¾ Ð¿Ñ€Ð¾ÑÑ‚Ð¾ Ð¾Ñ€Ð³Ð°Ð½Ð¸Ð·Ð¾Ð²Ð°Ð½Ð½Ð°Ñ ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð°, Ð¸ Ð½Ð¸ÐºÐ°ÐºÐ¾Ð¹ Ð¼Ð°Ð³Ð¸Ð¸ Ð·Ð´ÐµÑÑŒ Ð½ÐµÑ‚.

Ð”Ð°Ð²Ð°Ð¹ Ñ€Ð°ÑÑÐ¼Ð¾Ñ‚Ñ€Ð¸Ð¼ Ð¿Ñ€Ð¸Ñ‡Ð¸Ð½Ñƒ, Ð¿Ð¾Ñ‡ÐµÐ¼Ñƒ Ð¸Ð½Ð´ÐµÐºÑ ÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÐµÑ‚, Ð½Ð¾ Ð½Ðµ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ÑÑ.

|  |  |
| ------ | ------ |
|Ð˜Ð·ÑƒÑ‡Ð¸ Ð¸Ð·Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ðµ: ÐºÑ€Ð°ÑÐ½Ð°Ñ Ð»Ð¸Ð½Ð¸Ñ Ð¿Ð¾ÐºÐ°Ð·Ñ‹Ð²Ð°ÐµÑ‚ Ð»Ð¸Ð½ÐµÐ¹Ð½Ð¾Ðµ Ð²Ñ€ÐµÐ¼Ñ Ð¿Ð¾Ð¸ÑÐºÐ° Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð¿Ð¾ Ð·Ð°Ð¿Ñ€Ð¾ÑÑƒ. Ð˜Ð½Ñ‹Ð¼Ð¸ ÑÐ»Ð¾Ð²Ð°Ð¼Ð¸, ÐµÑÐ»Ð¸ Ð½ÑƒÐ¶Ð½Ð¾ Ñ‡Ñ‚Ð¾-Ñ‚Ð¾ Ð½Ð°Ð¹Ñ‚Ð¸, Ð¿Ñ€Ð¸Ñ…Ð¾Ð´Ð¸Ñ‚ÑÑ Ð¿Ñ€Ð¾ÑÐ¼Ð°Ñ‚Ñ€Ð¸Ð²Ð°Ñ‚ÑŒ ÐºÐ°Ð¶Ð´Ñ‹Ð¹ Ð±Ð»Ð¾Ðº, ÑÑ‚Ñ€Ð°Ð½Ð¸Ñ†Ñƒ, ÐºÐ¾Ñ€Ñ‚ÐµÐ¶ Ð¸ Ñ„Ð¾Ñ€Ð¼Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ ÑÐ¿Ð¸ÑÐ¾Ðº Ð¸ÑÐºÐ¾Ð¼Ñ‹Ñ… ÑÑ‚Ñ€Ð¾Ðº. (Ð­Ñ‚Ð¾Ñ‚ Ð¿Ñ€Ð¾Ñ†ÐµÑÑ Ð½Ð°Ð·Ñ‹Ð²Ð°ÐµÑ‚ÑÑ Â«Ð¿Ð¾ÑÐ»ÐµÐ´Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð¾Ðµ ÑÐºÐ°Ð½Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸ÐµÂ»). ÐÐ° ÑÐ°Ð¼Ð¾Ð¼ Ð´ÐµÐ»Ðµ, ÐµÑÐ»Ð¸ Ñ‚Ñ‹ ÑÐ¾Ð·Ð´Ð°ÐµÑˆÑŒ Ð¸Ð½Ð´ÐµÐºÑ B-Ð´ÐµÑ€ÐµÐ²Ð° (BTree), Ñ‚Ð¾ ÑÐºÐ¾Ñ€Ð¾ÑÑ‚ÑŒ Ð¿Ð¾Ð¸ÑÐºÐ° Ð·Ð½Ð°Ñ‡Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ ÑƒÐ»ÑƒÑ‡ÑˆÐ°ÐµÑ‚ÑÑ. Ð—ÐµÐ»ÐµÐ½Ð°Ñ Ð»Ð¸Ð½Ð¸Ñ ÑÐ¾Ð¾Ñ‚Ð²ÐµÑ‚ÑÑ‚Ð²ÑƒÐµÑ‚ Ð²Ñ€ÐµÐ¼ÐµÐ½Ð¸ Ð¿Ð¾Ð¸ÑÐºÐ° Ñ Ð»Ð¾Ð³Ð°Ñ€Ð¸Ñ„Ð¼Ð¸Ñ‡ÐµÑÐºÐ¾Ð¹ ÑÐ»Ð¾Ð¶Ð½Ð¾ÑÑ‚ÑŒÑŽ. ÐŸÑ€ÐµÐ´ÑÑ‚Ð°Ð²ÑŒ, Ñ‡Ñ‚Ð¾ Ñƒ Ñ‚ÐµÐ±Ñ ÐµÑÑ‚ÑŒ 1 000 000 ÑÑ‚Ñ€Ð¾Ðº, Ð¸ Ð´Ð»Ñ Ð¿Ð¾Ð¸ÑÐºÐ° Ð¾Ð´Ð½Ð¾Ð¹ ÑÑ‚Ñ€Ð¾ÐºÐ¸ Ð±ÐµÐ· Ð¸Ð½Ð´ÐµÐºÑÐ° Ñ‚Ñ€ÐµÐ±ÑƒÐµÑ‚ÑÑ, ÑÐºÐ°Ð¶ÐµÐ¼, 1 ÑÐµÐºÑƒÐ½Ð´Ð°. Ð¢Ð¾Ð³Ð´Ð° Ð½Ð° Ð¿Ð¾Ð»Ð½Ñ‹Ð¹ Ð¿Ð¾Ð¸ÑÐº ÑƒÐ¹Ð´ÐµÑ‚ 1 000 000 ÑÐµÐºÑƒÐ½Ð´. Ð¡ Ð¸Ð½Ð´ÐµÐºÑÐ¾Ð¼ Ð¶Ðµ Ð²Ñ€ÐµÐ¼Ñ Ð±ÑƒÐ´ÐµÑ‚ Ð¿Ñ€Ð¸Ð¼ÐµÑ€Ð½Ð¾ Ñ€Ð°Ð²Ð½Ð¾ ln(1 000 000) â‰ˆ 14 ÑÐµÐºÑƒÐ½Ð´Ð°Ð¼. | ![D05_02](misc/images/D05_02.png) |
| ![D05_03](misc/images/D05_03.png) | ÐÐ¾ Ð¿Ð¾Ñ‡ÐµÐ¼Ñƒ Ð¶Ðµ Ð¸Ð½Ð´ÐµÐºÑ Ð½Ðµ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚? Ð•ÑÑ‚ÑŒ Ð½ÐµÑÐºÐ¾Ð»ÑŒÐºÐ¾ Ð¿Ñ€Ð¸Ñ‡Ð¸Ð½, Ð½Ð¾ Ð¾ÑÐ½Ð¾Ð²Ð½Ð°Ñ ÑÐ²ÑÐ·Ð°Ð½Ð° Ñ Ð¾Ð±Ñ‰Ð¸Ð¼ ÐºÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾Ð¼ ÑÑ‚Ñ€Ð¾Ðº Ð² Ð¸Ð½Ð´ÐµÐºÑÐ¸Ñ€ÑƒÐµÐ¼Ð¾Ð¹ Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ðµ. ÐŸÐ¾ÑÐ¼Ð¾Ñ‚Ñ€Ð¸ Ð½Ð° Ð¸Ð·Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ðµ - Ð¶Ð¸Ñ€Ð½Ð¾Ð¹ ÑÐ¸Ð½ÐµÐ¹ Ð»Ð¸Ð½Ð¸ÐµÐ¹ Ð²Ñ‹Ð´ÐµÐ»ÐµÐ½ Ð¿ÑƒÑ‚ÑŒ Ð´Ð»Ñ Ð°Ð»Ð³Ð¾Ñ€Ð¸Ñ‚Ð¼Ð¾Ð² Ð¿Ð¾Ð¸ÑÐºÐ°. ÐšÐ°Ðº Ð²Ð¸Ð´Ð½Ð¾, Ð² Ð½Ð°Ñ‡Ð°Ð»Ðµ Ð»Ð¸Ð½ÐµÐ¹Ð½Ð¾Ðµ Ð²Ñ€ÐµÐ¼Ñ ÑÐ²Ð»ÑÐµÑ‚ÑÑ Ð±Ð¾Ð»ÐµÐµ Ð¿Ð¾Ð´Ñ…Ð¾Ð´ÑÑ‰Ð¸Ð¼ Ð´Ð»Ñ Ð°Ð»Ð³Ð¾Ñ€Ð¸Ñ‚Ð¼Ð¾Ð², Ñ‡ÐµÐ¼ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð»Ð¾Ð³Ð°Ñ€Ð¸Ñ„Ð¼Ð¸Ñ‡ÐµÑÐºÐ¾Ð³Ð¾ Ð¿Ð¾Ð¸ÑÐºÐ°. ÐšÐ°Ðº Ð½Ð°Ð¹Ñ‚Ð¸ ÑÑ‚Ñƒ Ñ‚Ð¾Ñ‡ÐºÑƒ Ð¿ÐµÑ€ÐµÑÐµÑ‡ÐµÐ½Ð¸Ñ? ÐŸÑ€Ð¾Ð²Ð¾Ð´Ð¸Ñ‚ÑŒ ÑÐºÑÐ¿ÐµÑ€Ð¸Ð¼ÐµÐ½Ñ‚Ñ‹, Ð±ÐµÐ½Ñ‡Ð¼Ð°Ñ€ÐºÐ¸ Ð¸ ... Ð¿Ð¾Ð»Ð°Ð³Ð°Ñ‚ÑŒÑÑ Ð½Ð° Ð¸Ð½Ñ‚ÑƒÐ¸Ñ†Ð¸ÑŽ. ÐÐ±ÑÐ¾Ð»ÑŽÑ‚Ð½Ð¾ Ð½Ð¸ÐºÐ°ÐºÐ¸Ñ… Ñ„Ð¾Ñ€Ð¼ÑƒÐ». ÐŸÐ¾ÑÑ‚Ð¾Ð¼Ñƒ, ÐµÑÐ»Ð¸ Ñ‚Ñ‹ Ñ…Ð¾Ñ‡ÐµÑˆÑŒ ÑÑ€Ð°Ð²Ð½Ð¸Ñ‚ÑŒ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ñ‹ ÑÐ²Ð¾Ð¸Ñ… Ð¿Ð¾Ð¸ÑÐºÐ¾Ð², Ð¸Ð½Ð¾Ð³Ð´Ð° Ð¿Ñ€Ð¸Ñ…Ð¾Ð´Ð¸Ñ‚ÑÑ ÑÐ²Ð½Ð¾ Ð¾Ñ‚ÐºÐ»ÑŽÑ‡Ð°Ñ‚ÑŒ Ð¿Ð¾ÑÐ»ÐµÐ´Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð¾Ðµ ÑÐºÐ°Ð½Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ. ÐÐ°Ð¿Ñ€Ð¸Ð¼ÐµÑ€, Ð² PostgreSQL ÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÐµÑ‚ ÑÐ¿ÐµÑ†Ð¸Ð°Ð»ÑŒÐ½Ð°Ñ ÐºÐ¾Ð¼Ð°Ð½Ð´Ð° set enable_seqscan = off. |

## Chapter II
## Ð ÐµÐºÐ¾Ð¼ÐµÐ½Ð´Ð°Ñ†Ð¸Ð¸ Ðº Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸ÑŽ ÑÑ‚Ð¾Ð³Ð¾ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð°

- Ð£Ð±ÐµÐ´Ð¸ÑÑŒ, Ñ‡Ñ‚Ð¾ Ñ‚Ñ‹ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑˆÑŒ Ñ Ð¿Ð¾ÑÐ»ÐµÐ´Ð½ÐµÐ¹ Ð²ÐµÑ€ÑÐ¸ÐµÐ¹ PostgreSQL.  
- Ð¢Ñ‹ Ð¼Ð¾Ð¶ÐµÑˆÑŒ Ð¿Ð¸ÑÐ°Ñ‚ÑŒ ÐºÐ¾Ð´ (SQL-ÑÐºÑ€Ð¸Ð¿Ñ‚Ñ‹) Ð² Ð»ÑŽÐ±Ð¾Ð¹ ÑƒÐ´Ð¾Ð±Ð½Ð¾Ð¹ IDE - ÑÑ‚Ð¾ ÑÐ¾Ð²ÐµÑ€ÑˆÐµÐ½Ð½Ð¾ Ð½Ð¾Ñ€Ð¼Ð°Ð»ÑŒÐ½Ð¾.  
- Ð’ Ð´Ð¸Ñ€ÐµÐºÑ‚Ð¾Ñ€Ð¸Ð¸ Ð´Ð¾Ð»Ð¶Ð½Ñ‹ Ð¾ÑÑ‚Ð°Ð²Ð°Ñ‚ÑŒÑÑ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ñ„Ð°Ð¹Ð»Ñ‹, ÑÐ²Ð½Ð¾ ÑƒÐºÐ°Ð·Ð°Ð½Ð½Ñ‹Ðµ Ð² Ð·Ð°Ð´Ð°Ð½Ð¸Ð¸. ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ `.gitignore`, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð¸Ð·Ð±ÐµÐ¶Ð°Ñ‚ÑŒ ÑÐ»ÑƒÑ‡Ð°Ð¹Ð½Ñ‹Ñ… Ð¾ÑˆÐ¸Ð±Ð¾Ðº.  
- Ð£Ð±ÐµÐ´Ð¸ÑÑŒ, Ñ‡Ñ‚Ð¾ Ñƒ Ñ‚ÐµÐ±Ñ ÐµÑÑ‚ÑŒ Ð»Ð¸Ñ‡Ð½Ð°Ñ Ð±Ð°Ð·Ð° Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð¸ Ð´Ð¾ÑÑ‚ÑƒÐ¿ Ðº Ð½ÐµÐ¹ Ð² Ñ‚Ð²Ð¾ÐµÐ¼ ÐºÐ»Ð°ÑÑ‚ÐµÑ€Ðµ PostgreSQL.  
- CÐºÐ°Ñ‡Ð°Ð¹ [ÑÐºÑ€Ð¸Ð¿Ñ‚](materials/model.sql) Ð¸Ð· Ð¿Ð°Ð¿ÐºÐ¸ Materials Ñ Ð¼Ð¾Ð´ÐµÐ»ÑŒÑŽ Ð±Ð°Ð·Ñ‹ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð¸ Ð¿Ñ€Ð¸Ð¼ÐµÐ½Ð¸ ÐµÐ³Ð¾ Ðº ÑÐ²Ð¾ÐµÐ¹ Ð±Ð°Ð·Ðµ - ÑÐ´ÐµÐ»Ð°Ñ‚ÑŒ ÑÑ‚Ð¾ Ð¼Ð¾Ð¶Ð½Ð¾ Ð»Ð¸Ð±Ð¾ Ñ‡ÐµÑ€ÐµÐ· ÐºÐ¾Ð¼Ð°Ð½Ð´Ð½ÑƒÑŽ ÑÑ‚Ñ€Ð¾ÐºÑƒ Ñ Ð¿Ð¾Ð¼Ð¾Ñ‰ÑŒÑŽ psql, Ð»Ð¸Ð±Ð¾ Ñ‡ÐµÑ€ÐµÐ· Ð»ÑŽÐ±ÑƒÑŽ ÑƒÐ´Ð¾Ð±Ð½ÑƒÑŽ IDE, Ð½Ð°Ð¿Ñ€Ð¸Ð¼ÐµÑ€ DataGrip Ð¾Ñ‚ JetBrains Ð¸Ð»Ð¸ pgAdmin Ð¸Ð· ÑÐ¾Ð¾Ð±Ñ‰ÐµÑÑ‚Ð²Ð° PostgreSQL. **ÐŸÑ€Ð¾Ñ†ÐµÑÑ Ð¾Ð±ÑƒÑ‡ÐµÐ½Ð¸Ñ ÑÐ²Ð»ÑÐµÑ‚ÑÑ Ð¸Ð½ÐºÑ€ÐµÐ¼ÐµÐ½Ñ‚Ð½Ñ‹Ð¼ Ð¸ Ð»Ð¸Ð½ÐµÐ¹Ð½Ñ‹Ð¼, Ð¿Ð¾ÑÑ‚Ð¾Ð¼Ñƒ ÑƒÐ±ÐµÐ´Ð¸ÑÑŒ, Ñ‡Ñ‚Ð¾ Ð²ÑÐµ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ, ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ðµ Ð±Ñ‹Ð»Ð¸ Ð²Ð½ÐµÑÐµÐ½Ñ‹ Ð² Ð¿Ñ€Ð¾ÐµÐºÑ‚ SQLB4_DML (Day 03) Ð² Ñ…Ð¾Ð´Ðµ Ð·Ð°Ð´Ð°Ð½Ð¸Ð¹ 07-13, Ð´Ð¾Ð»Ð¶Ð½Ñ‹ ÑÐ¾Ñ…Ñ€Ð°Ð½ÑÑ‚ÑŒÑÑ (ÑÑ‚Ð¾ Ð¿Ð¾Ñ…Ð¾Ð¶Ðµ Ð½Ð° Ñ€ÐµÐ°Ð»ÑŒÐ½ÑƒÑŽ ÑÐ¸Ñ‚ÑƒÐ°Ñ†Ð¸ÑŽ, ÐºÐ¾Ð³Ð´Ð° Ð¿Ð¾ÑÐ»Ðµ Ð²Ñ‹Ð¿ÑƒÑÐºÐ° Ñ€ÐµÐ»Ð¸Ð·Ð° Ñ‚Ñ€ÐµÐ±ÑƒÐµÑ‚ÑÑ Ð¾Ð±ÐµÑÐ¿ÐµÑ‡Ð¸Ñ‚ÑŒ ÑÐ¾Ð³Ð»Ð°ÑÐ¾Ð²Ð°Ð½Ð½Ð¾ÑÑ‚ÑŒ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð´Ð»Ñ Ð½Ð¾Ð²Ñ‹Ñ… Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ð¹).**  
- Ð’ ÐºÐ°Ð¶Ð´Ð¾Ð¼ Ð·Ð°Ð´Ð°Ð½Ð¸Ð¸ Ð²Ð½Ð¸Ð¼Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð¾ Ð¾Ð·Ð½Ð°ÐºÐ¾Ð¼ÑŒÑÑ Ñ Ñ€Ð°Ð·Ð´ÐµÐ»Ð°Ð¼Ð¸ Â«Ð Ð°Ð·Ñ€ÐµÑˆÐµÐ½Ð¾Â» Ð¸ Â«Ð—Ð°Ð¿Ñ€ÐµÑ‰ÐµÐ½Ð¾Â» - Ñ‚Ð°Ð¼ Ð¿ÐµÑ€ÐµÑ‡Ð¸ÑÐ»ÐµÐ½Ñ‹ Ð´Ð¾Ð¿ÑƒÑÑ‚Ð¸Ð¼Ñ‹Ðµ Ð¾Ð¿Ñ†Ð¸Ð¸ Ð±Ð°Ð·Ñ‹ Ð´Ð°Ð½Ð½Ñ‹Ñ…, Ñ‚Ð¸Ð¿Ñ‹, ÐºÐ¾Ð½ÑÑ‚Ñ€ÑƒÐºÑ†Ð¸Ð¸ SQL Ð¸ Ð´Ñ€ÑƒÐ³Ð¸Ðµ Ð²Ð°Ð¶Ð½Ñ‹Ðµ Ð¾Ð³Ñ€Ð°Ð½Ð¸Ñ‡ÐµÐ½Ð¸Ñ.  
- Ð”Ð° Ð¿Ñ€Ð¸Ð±ÑƒÐ´ÐµÑ‚ Ñ Ñ‚Ð¾Ð±Ð¾Ð¹ ÑÐ¸Ð»Ð° SQL 
- ÐŸÑ€Ð¸ÑÑ‚ÑƒÐ¿Ð°Ð¹ Ðº Ñ€Ð°Ð±Ð¾Ñ‚Ðµ - Ð¸ Ð¿ÑƒÑÑ‚ÑŒ ÑÑ‚Ð¾ Ð±ÑƒÐ´ÐµÑ‚ ÑƒÐ²Ð»ÐµÐºÐ°Ñ‚ÐµÐ»ÑŒÐ½Ð¾!

ÐŸÐµÑ€ÐµÐ´ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸ÐµÐ¼ Ð·Ð°Ð´Ð°Ð½Ð¸Ð¹ Ð¸Ð·ÑƒÑ‡Ð¸ Ð»Ð¾Ð³Ð¸Ñ‡ÐµÑÐºÑƒÑŽ ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ñƒ Ð¼Ð¾Ð´ÐµÐ»Ð¸ Ð±Ð°Ð·Ñ‹ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð½Ð¸Ð¶Ðµ.

![schema](misc/images/schema.png)

1. Ð¢Ð°Ð±Ð»Ð¸Ñ†Ð° **pizzeria** (ÑÐ¿Ñ€Ð°Ð²Ð¾Ñ‡Ð½Ð¸Ðº Ð¿Ð¸Ñ†Ñ†ÐµÑ€Ð¸Ð¹)
- Ð¿Ð¾Ð»Ðµ id - Ð¿ÐµÑ€Ð²Ð¸Ñ‡Ð½Ñ‹Ð¹ ÐºÐ»ÑŽÑ‡  
- Ð¿Ð¾Ð»Ðµ name - Ð½Ð°Ð·Ð²Ð°Ð½Ð¸Ðµ Ð¿Ð¸Ñ†Ñ†ÐµÑ€Ð¸Ð¸  
- Ð¿Ð¾Ð»Ðµ rating - ÑÑ€ÐµÐ´Ð½Ð¸Ð¹ Ñ€ÐµÐ¹Ñ‚Ð¸Ð½Ð³ Ð¿Ð¸Ñ†Ñ†ÐµÑ€Ð¸Ð¸ (Ð¾Ñ‚ 0 Ð´Ð¾ 5 Ð±Ð°Ð»Ð»Ð¾Ð²)

2. Ð¢Ð°Ð±Ð»Ð¸Ñ†Ð° **person** (ÑÐ¿Ñ€Ð°Ð²Ð¾Ñ‡Ð½Ð¸Ðº ÐºÐ»Ð¸ÐµÐ½Ñ‚Ð¾Ð², Ð»ÑŽÐ±ÑÑ‰Ð¸Ñ… Ð¿Ð¸Ñ†Ñ†Ñƒ)
- Ð¿Ð¾Ð»Ðµ id - Ð¿ÐµÑ€Ð²Ð¸Ñ‡Ð½Ñ‹Ð¹ ÐºÐ»ÑŽÑ‡  
- Ð¿Ð¾Ð»Ðµ name - Ð¸Ð¼Ñ Ñ‡ÐµÐ»Ð¾Ð²ÐµÐºÐ°  
- Ð¿Ð¾Ð»Ðµ age - Ð²Ð¾Ð·Ñ€Ð°ÑÑ‚ Ñ‡ÐµÐ»Ð¾Ð²ÐµÐºÐ°  
- Ð¿Ð¾Ð»Ðµ gender - Ð¿Ð¾Ð» Ñ‡ÐµÐ»Ð¾Ð²ÐµÐºÐ°  
- Ð¿Ð¾Ð»Ðµ address - Ð°Ð´Ñ€ÐµÑ Ñ‡ÐµÐ»Ð¾Ð²ÐµÐºÐ°

3. Ð¢Ð°Ð±Ð»Ð¸Ñ†Ð° **menu** (ÑÐ¿Ñ€Ð°Ð²Ð¾Ñ‡Ð½Ð¸Ðº Ñ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ñ‹Ð¼ Ð¼ÐµÐ½ÑŽ Ð¸ Ñ†ÐµÐ½Ð°Ð¼Ð¸ Ð½Ð° ÐºÐ¾Ð½ÐºÑ€ÐµÑ‚Ð½Ñ‹Ðµ Ð¿Ð¸Ñ†Ñ†Ñ‹)
- Ð¿Ð¾Ð»Ðµ id - Ð¿ÐµÑ€Ð²Ð¸Ñ‡Ð½Ñ‹Ð¹ ÐºÐ»ÑŽÑ‡  
- Ð¿Ð¾Ð»Ðµ pizzeria_id - Ð²Ð½ÐµÑˆÐ½Ð¸Ð¹ ÐºÐ»ÑŽÑ‡ Ð½Ð° Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ñƒ pizzeria  
- Ð¿Ð¾Ð»Ðµ pizza_name - Ð½Ð°Ð·Ð²Ð°Ð½Ð¸Ðµ Ð¿Ð¸Ñ†Ñ†Ñ‹ Ð² Ð¿Ð¸Ñ†Ñ†ÐµÑ€Ð¸Ð¸  
- Ð¿Ð¾Ð»Ðµ price - Ñ†ÐµÐ½Ð° ÐºÐ¾Ð½ÐºÑ€ÐµÑ‚Ð½Ð¾Ð¹ Ð¿Ð¸Ñ†Ñ†Ñ‹

4. Ð¢Ð°Ð±Ð»Ð¸Ñ†Ð° **person_visits** (Ð¶ÑƒÑ€Ð½Ð°Ð» Ð¿Ð¾ÑÐµÑ‰ÐµÐ½Ð¸Ð¹ Ð¿Ð¸Ñ†Ñ†ÐµÑ€Ð¸Ð¹)
- Ð¿Ð¾Ð»Ðµ id - Ð¿ÐµÑ€Ð²Ð¸Ñ‡Ð½Ñ‹Ð¹ ÐºÐ»ÑŽÑ‡  
- Ð¿Ð¾Ð»Ðµ person_id - Ð²Ð½ÐµÑˆÐ½Ð¸Ð¹ ÐºÐ»ÑŽÑ‡ Ð½Ð° Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ñƒ person  
- Ð¿Ð¾Ð»Ðµ pizzeria_id - Ð²Ð½ÐµÑˆÐ½Ð¸Ð¹ ÐºÐ»ÑŽÑ‡ Ð½Ð° Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ñƒ pizzeria  
- Ð¿Ð¾Ð»Ðµ visit_date - Ð´Ð°Ñ‚Ð° Ð¿Ð¾ÑÐµÑ‰ÐµÐ½Ð¸Ñ (Ð½Ð°Ð¿Ñ€Ð¸Ð¼ÐµÑ€, 2022-01-01)

5. Ð¢Ð°Ð±Ð»Ð¸Ñ†Ð° **person_order** (Ð¶ÑƒÑ€Ð½Ð°Ð» Ð·Ð°ÐºÐ°Ð·Ð¾Ð²)
- Ð¿Ð¾Ð»Ðµ id - Ð¿ÐµÑ€Ð²Ð¸Ñ‡Ð½Ñ‹Ð¹ ÐºÐ»ÑŽÑ‡  
- Ð¿Ð¾Ð»Ðµ person_id - Ð²Ð½ÐµÑˆÐ½Ð¸Ð¹ ÐºÐ»ÑŽÑ‡ Ð½Ð° Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ñƒ person  
- Ð¿Ð¾Ð»Ðµ menu_id - Ð²Ð½ÐµÑˆÐ½Ð¸Ð¹ ÐºÐ»ÑŽÑ‡ Ð½Ð° Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ñƒ menu  
- Ð¿Ð¾Ð»Ðµ order_date - Ð´Ð°Ñ‚Ð° Ð·Ð°ÐºÐ°Ð·Ð° (Ð½Ð°Ð¿Ñ€Ð¸Ð¼ÐµÑ€, 2022-01-01)

ÐŸÐ¾ÑÐµÑ‰ÐµÐ½Ð¸Ñ Ð¿Ð¸Ñ†Ñ†ÐµÑ€Ð¸Ð¹ Ð¸ Ð·Ð°ÐºÐ°Ð·Ñ‹ - ÑÑ‚Ð¾ Ñ€Ð°Ð·Ð½Ñ‹Ðµ ÑÑƒÑ‰Ð½Ð¾ÑÑ‚Ð¸, Ð¼ÐµÐ¶Ð´Ñƒ ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ð¼Ð¸ Ð½ÐµÑ‚ Ð¿Ñ€ÑÐ¼Ð¾Ð¹ Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚Ð¸ Ð² Ð´Ð°Ð½Ð½Ñ‹Ñ…. ÐÐ°Ð¿Ñ€Ð¸Ð¼ÐµÑ€, ÐºÐ»Ð¸ÐµÐ½Ñ‚ Ð¼Ð¾Ð¶ÐµÑ‚ Ð½Ð°Ñ…Ð¾Ð´Ð¸Ñ‚ÑŒÑÑ Ð² Ð¾Ð´Ð½Ð¾Ð¼ Ñ€ÐµÑÑ‚Ð¾Ñ€Ð°Ð½Ðµ, Ð¿Ñ€Ð¾ÑÑ‚Ð¾ Ð¿Ñ€Ð¾ÑÐ¼Ð°Ñ‚Ñ€Ð¸Ð²Ð°Ñ Ð¼ÐµÐ½ÑŽ, Ð¸ Ð¾Ð´Ð½Ð¾Ð²Ñ€ÐµÐ¼ÐµÐ½Ð½Ð¾ ÑÐ´ÐµÐ»Ð°Ñ‚ÑŒ Ð·Ð°ÐºÐ°Ð· Ð² Ð´Ñ€ÑƒÐ³Ð¾Ð¼ Ñ€ÐµÑÑ‚Ð¾Ñ€Ð°Ð½Ðµ Ð¿Ð¾ Ñ‚ÐµÐ»ÐµÑ„Ð¾Ð½Ñƒ Ð¸Ð»Ð¸ Ñ‡ÐµÑ€ÐµÐ· Ð¼Ð¾Ð±Ð¸Ð»ÑŒÐ½Ð¾Ðµ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ. Ð˜Ð»Ð¸ Ð´Ñ€ÑƒÐ³Ð¾Ð¹ Ð²Ð°Ñ€Ð¸Ð°Ð½Ñ‚ - Ð±Ñ‹Ñ‚ÑŒ Ð´Ð¾Ð¼Ð° Ð¸ Ð¾Ñ„Ð¾Ñ€Ð¼Ð¸Ñ‚ÑŒ Ð·Ð°ÐºÐ°Ð· Ð¿Ð¾ Ñ‚ÐµÐ»ÐµÑ„Ð¾Ð½Ñƒ, Ð½Ðµ Ð¿Ð¾ÑÐµÑ‰Ð°Ñ Ð·Ð°Ð²ÐµÐ´ÐµÐ½Ð¸Ðµ Ð²Ð¾Ð²ÑÐµ.

## Chapter III
## Ð—Ð°Ð´Ð°Ð½Ð¸Ðµ 00 â€” Letâ€™s create indexes for every foreign key

| Ð—Ð°Ð´Ð°Ð½Ð¸Ðµ 00: Letâ€™s create indexes for every foreign key |                                                                                                                          |
|---------------------------------------|--------------------------------------------------------------------------------------------------------------------------|
| Ð”Ð¸Ñ€ÐµÐºÑ‚Ð¾Ñ€Ð¸Ñ Ð´Ð»Ñ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ Ñ€ÐµÑˆÐµÐ½Ð¸Ð¹       | ex00                                                                                                                     |
| Ð¤Ð°Ð¹Ð»Ñ‹ Ð´Ð»Ñ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸                    | `day05_ex00.sql`                                                                                 |
| **Ð Ð°Ð·Ñ€ÐµÑˆÐµÐ½Ð¾**                         |                                                                                                                          |
| Ð¯Ð·Ñ‹Ðº                                  | ANSI SQL                                                                                              |
Ð¡Ð¾Ð·Ð´Ð°Ð¹ Ð¿Ñ€Ð¾ÑÑ‚Ð¾Ð¹ BTree index Ð´Ð»Ñ ÐºÐ°Ð¶Ð´Ð¾Ð³Ð¾ Ð²Ð½ÐµÑˆÐ½ÐµÐ³Ð¾ ÐºÐ»ÑŽÑ‡Ð° Ð² Ð½Ð°ÑˆÐµÐ¹ Ð±Ð°Ð·Ðµ Ð´Ð°Ð½Ð½Ñ‹Ñ….

Ð¨Ð°Ð±Ð»Ð¾Ð½ Ð¸Ð¼ÐµÐ½Ð¸ Ð´Ð¾Ð»Ð¶ÐµÐ½ ÑÐ¾Ð¾Ñ‚Ð²ÐµÑ‚ÑÑ‚Ð²Ð¾Ð²Ð°Ñ‚ÑŒ ÑÐ»ÐµÐ´ÑƒÑŽÑ‰ÐµÐ¼Ñƒ Ð¿Ñ€Ð°Ð²Ð¸Ð»Ñƒ: idx_{Ð¸Ð¼Ñ_Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ñ‹}_{Ð¸Ð¼Ñ_ÑÑ‚Ð¾Ð»Ð±Ñ†Ð°}.

ÐÐ°Ð¿Ñ€Ð¸Ð¼ÐµÑ€, Ð¸Ð¼Ñ Ð¸Ð½Ð´ÐµÐºÑÐ° Ñ‚Ð¸Ð¿Ð° B-Ð´ÐµÑ€ÐµÐ²Ð¾ Ð´Ð»Ñ ÑÑ‚Ð¾Ð»Ð±Ñ†Ð° pizzeria_id Ð² Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ðµ `menu` Ð±ÑƒÐ´ÐµÑ‚ `idx_menu_pizzeria_id`.

## Ð—Ð°Ð´Ð°Ð½Ð¸Ðµ 01 â€” How to see that index works?

| Ð—Ð°Ð´Ð°Ð½Ð¸Ðµ 01: How to see that index works? |                                                                                                                          |
|---------------------------------------|--------------------------------------------------------------------------------------------------------------------------|
| Ð”Ð¸Ñ€ÐµÐºÑ‚Ð¾Ñ€Ð¸Ñ Ð´Ð»Ñ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ Ñ€ÐµÑˆÐµÐ½Ð¸Ð¹       | ex01                                                                                                                     |
| Ð¤Ð°Ð¹Ð»Ñ‹ Ð´Ð»Ñ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸                    | `day05_ex01.sql`                                                                                 |
| **Ð Ð°Ð·Ñ€ÐµÑˆÐµÐ½Ð¾**                         |                                                                                                                          |
| Ð¯Ð·Ñ‹Ðº                                  | ANSI SQL                                                                                              |

ÐŸÑ€ÐµÐ¶Ð´Ðµ Ñ‡ÐµÐ¼ Ð¿Ñ€Ð¾Ð´Ð¾Ð»Ð¶Ð¸Ñ‚ÑŒ, Ð½Ð°Ð¿Ð¸ÑˆÐ¸ SQL-Ð·Ð°Ð¿Ñ€Ð¾Ñ, ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ð¹ Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÐµÑ‚ Ð½Ð°Ð·Ð²Ð°Ð½Ð¸Ñ Ð¿Ð¸Ñ†Ñ† Ð¸ ÑÐ¾Ð¾Ñ‚Ð²ÐµÑ‚ÑÑ‚Ð²ÑƒÑŽÑ‰Ð¸Ðµ Ð½Ð°Ð·Ð²Ð°Ð½Ð¸Ñ Ð¿Ð¸Ñ†Ñ†ÐµÑ€Ð¸Ð¹.

ÐžÐ·Ð½Ð°ÐºÐ¾Ð¼ÑŒÑÑ Ñ Ð¿Ñ€Ð¸Ð¼ÐµÑ€Ð¾Ð¼ Ð¾Ð¶Ð¸Ð´Ð°ÐµÐ¼Ð¾Ð³Ð¾ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ð° Ð½Ð¸Ð¶Ðµ (ÑÐ¾Ñ€Ñ‚Ð¸Ñ€Ð¾Ð²ÐºÐ° Ð½Ðµ Ñ‚Ñ€ÐµÐ±ÑƒÐµÑ‚ÑÑ).

| pizza_name | pizzeria_name | 
| ------ | ------ |
| cheese pizza | Pizza Hut |
| ... | ... |

ÐÐµÐ¾Ð±Ñ…Ð¾Ð´Ð¸Ð¼Ð¾ ÑƒÐ±ÐµÐ´Ð¸Ñ‚ÑŒÑÑ, Ñ‡Ñ‚Ð¾ Ð¸Ð½Ð´ÐµÐºÑÑ‹ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÑŽÑ‚ Ð´Ð»Ñ Ñ‚Ð²Ð¾ÐµÐ³Ð¾ SQL-Ð·Ð°Ð¿Ñ€Ð¾ÑÐ°. 

Ð’ ÐºÐ°Ñ‡ÐµÑÑ‚Ð²Ðµ Ð´Ð¾ÐºÐ°Ð·Ð°Ñ‚ÐµÐ»ÑŒÑÑ‚Ð²Ð° Ð¿Ð¾Ñ‚Ñ€ÐµÐ±ÑƒÐµÑ‚ÑÑ Ð²Ñ‹Ð²Ð¾Ð´ ÐºÐ¾Ð¼Ð°Ð½Ð´Ñ‹ `EXPLAIN ANALYZE`.

ÐžÐ·Ð½Ð°ÐºÐ¾Ð¼ÑŒÑÑ Ñ Ð¿Ñ€Ð¸Ð¼ÐµÑ€Ð¾Ð¼ Ð²Ñ‹Ð²Ð¾Ð´Ð° ÑÑ‚Ð¾Ð¹ ÐºÐ¾Ð¼Ð°Ð½Ð´Ñ‹:
    
    ...
    ->  Index Scan using idx_menu_pizzeria_id on menu m  (...)
    ...

**ÐŸÐ¾Ð´ÑÐºÐ°Ð·ÐºÐ°**: ÐŸÐ¾Ð´ÑƒÐ¼Ð°Ð¹, Ð¿Ð¾Ñ‡ÐµÐ¼Ñƒ Ñ‚Ð²Ð¾Ð¸ Ð¸Ð½Ð´ÐµÐºÑÑ‹ Ð¼Ð¾Ð³ÑƒÑ‚ Ð½Ðµ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÑŒÑÑ Ð½Ð°Ð¿Ñ€ÑÐ¼ÑƒÑŽ, Ð¸ Ñ‡Ñ‚Ð¾ Ð½ÑƒÐ¶Ð½Ð¾ ÑÐ´ÐµÐ»Ð°Ñ‚ÑŒ, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð¸Ñ… Ð·Ð°Ð´ÐµÐ¹ÑÑ‚Ð²Ð¾Ð²Ð°Ñ‚ÑŒ?

## Ð—Ð°Ð´Ð°Ð½Ð¸Ðµ 02 â€” Formula is in the index. Is it Ok?

| Ð—Ð°Ð´Ð°Ð½Ð¸Ðµ 02: Formula is in the index. Is it Ok? |                                                                                                                          |
|---------------------------------------|--------------------------------------------------------------------------------------------------------------------------|
| Ð”Ð¸Ñ€ÐµÐºÑ‚Ð¾Ñ€Ð¸Ñ Ð´Ð»Ñ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ Ñ€ÐµÑˆÐµÐ½Ð¸Ð¹       | ex02                                                                                                                     |
| Ð¤Ð°Ð¹Ð»Ñ‹ Ð´Ð»Ñ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸                    | `day05_ex02.sql`                                                                                 |
| **Ð Ð°Ð·Ñ€ÐµÑˆÐµÐ½Ð¾**                         |                                                                                                                          |
| Ð¯Ð·Ñ‹Ðº                                  | ANSI SQL                                                                                              |

Ð¡Ð¾Ð·Ð´Ð°Ð¹ Ñ„ÑƒÐ½ÐºÑ†Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ñ‹Ð¹ B-Tree index Ñ Ð¸Ð¼ÐµÐ½ÐµÐ¼ `idx_person_name` Ð¿Ð¾ ÑÑ‚Ð¾Ð»Ð±Ñ†Ñƒ `name` Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ñ‹ person. Ð˜Ð½Ð´ÐµÐºÑ Ð´Ð¾Ð»Ð¶ÐµÐ½ ÑÐ¾Ð´ÐµÑ€Ð¶Ð°Ñ‚ÑŒ Ð¸Ð¼ÐµÐ½Ð° Ð»ÑŽÐ´ÐµÐ¹ Ð² Ð²ÐµÑ€Ñ…Ð½ÐµÐ¼ Ñ€ÐµÐ³Ð¸ÑÑ‚Ñ€Ðµ.

ÐÐ°Ð¿Ð¸ÑˆÐ¸Ñ‚Ðµ Ð¸ Ð¿Ñ€ÐµÐ´Ð¾ÑÑ‚Ð°Ð²ÑŒÑ‚Ðµ Ð»ÑŽÐ±Ð¾Ð¹ SQL-Ð·Ð°Ð¿Ñ€Ð¾Ñ Ñ Ð´Ð¾ÐºÐ°Ð·Ð°Ñ‚ÐµÐ»ÑŒÑÑ‚Ð²Ð¾Ð¼ Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹ Ð¸Ð½Ð´ÐµÐºÑÐ° (`EXPLAIN ANALYZE`), Ð´ÐµÐ¼Ð¾Ð½ÑÑ‚Ñ€Ð¸Ñ€ÑƒÑŽÑ‰Ð¸Ð¼, Ñ‡Ñ‚Ð¾ Ð¸Ð½Ð´ÐµÐºÑ idx_person_name Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ÑÑ.

## Ð—Ð°Ð´Ð°Ð½Ð¸Ðµ 03 â€” Multicolumn index for our goals

| Ð—Ð°Ð´Ð°Ð½Ð¸Ðµ 03: Multicolumn index for our goals |                                                                                                                          |
|---------------------------------------|--------------------------------------------------------------------------------------------------------------------------|
| Ð”Ð¸Ñ€ÐµÐºÑ‚Ð¾Ñ€Ð¸Ñ Ð´Ð»Ñ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ Ñ€ÐµÑˆÐµÐ½Ð¸Ð¹       | ex03                                                                                                                     |
| Ð¤Ð°Ð¹Ð»Ñ‹ Ð´Ð»Ñ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸                    | `day05_ex03.sql`                                                                                 |
| **Ð Ð°Ð·Ñ€ÐµÑˆÐµÐ½Ð¾**                         |                                                                                                                          |
| Ð¯Ð·Ñ‹Ðº                                  | ANSI SQL                                                                                              |

Ð¡Ð¾Ð·Ð´Ð°Ð¹ ÑƒÐ»ÑƒÑ‡ÑˆÐµÐ½Ð½Ñ‹Ð¹ Ð¼Ð½Ð¾Ð³Ð¾ÐºÐ¾Ð»Ð¾Ð½Ð¾Ñ‡Ð½Ñ‹Ð¹ B-Tree index Ñ Ð¸Ð¼ÐµÐ½ÐµÐ¼ `idx_person_order_multi` Ð´Ð»Ñ Ð¿Ñ€Ð¸Ð²ÐµÐ´ÐµÐ½Ð½Ð¾Ð³Ð¾ Ð½Ð¸Ð¶Ðµ SQL-Ð·Ð°Ð¿Ñ€Ð¾ÑÐ°.

    SELECT person_id, menu_id,order_date
    FROM person_order
    WHERE person_id = 8 AND menu_id = 19;

ÐšÐ¾Ð¼Ð°Ð½Ð´Ð° `EXPLAIN ANALYZE` Ð´Ð¾Ð»Ð¶Ð½Ð° Ð²ÐµÑ€Ð½ÑƒÑ‚ÑŒ Ð¿Ð»Ð°Ð½ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ñ, ÑÐ¾Ð¾Ñ‚Ð²ÐµÑ‚ÑÑ‚Ð²ÑƒÑŽÑ‰Ð¸Ð¹ ÑÐ»ÐµÐ´ÑƒÑŽÑ‰ÐµÐ¼Ñƒ ÑˆÐ°Ð±Ð»Ð¾Ð½Ñƒ. ÐžÐ±Ñ€Ð°Ñ‚Ð¸ Ð¾ÑÐ¾Ð±Ð¾Ðµ Ð²Ð½Ð¸Ð¼Ð°Ð½Ð¸Ðµ Ð½Ð° Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ðµ ÑÐºÐ°Ð½Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ "Index Only Scan"!

    Index Only Scan using idx_person_order_multi on person_order ...

ÐŸÑ€ÐµÐ´Ð¾ÑÑ‚Ð°Ð²ÑŒ Ð»ÑŽÐ±Ð¾Ð¹ SQL-Ð·Ð°Ð¿Ñ€Ð¾Ñ Ñ Ð´Ð¾ÐºÐ°Ð·Ð°Ñ‚ÐµÐ»ÑŒÑÑ‚Ð²Ð¾Ð¼ Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹ Ð¸Ð½Ð´ÐµÐºÑÐ° (`EXPLAIN ANALYZE`), Ð´ÐµÐ¼Ð¾Ð½ÑÑ‚Ñ€Ð¸Ñ€ÑƒÑŽÑ‰Ð¸Ð¼, Ñ‡Ñ‚Ð¾ Ð¸Ð½Ð´ÐµÐºÑ `idx_person_order_multi` Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ÑÑ.

## Ð—Ð°Ð´Ð°Ð½Ð¸Ðµ 04 â€” Uniqueness for data

| Ð—Ð°Ð´Ð°Ð½Ð¸Ðµ 04: Uniqueness for data |                                                                                                                          |
|---------------------------------------|--------------------------------------------------------------------------------------------------------------------------|
| Ð”Ð¸Ñ€ÐµÐºÑ‚Ð¾Ñ€Ð¸Ñ Ð´Ð»Ñ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ Ñ€ÐµÑˆÐµÐ½Ð¸Ð¹       | ex04                                                                                                                     |
| Ð¤Ð°Ð¹Ð»Ñ‹ Ð´Ð»Ñ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸                    | `day05_ex04.sql`                                                                                 |
| **Ð Ð°Ð·Ñ€ÐµÑˆÐµÐ½Ð¾**                         |                                                                                                                          |
| Ð¯Ð·Ñ‹Ðº                                  | ANSI SQL                                                                                              |

CÐ¾Ð·Ð´Ð°Ð¹ ÑƒÐ½Ð¸ÐºÐ°Ð»ÑŒÐ½Ñ‹Ð¹ B-Tree index Ñ Ð¸Ð¼ÐµÐ½ÐµÐ¼ `idx_menu_unique` Ð´Ð»Ñ Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ñ‹ `menu` Ð´Ð»Ñ ÑÑ‚Ð¾Ð»Ð±Ñ†Ð¾Ð² `pizzeria_id` Ð¸ `pizza_name`. 

ÐÐ°Ð¿Ð¸ÑˆÐ¸ Ð¸ Ð¿Ñ€ÐµÐ´Ð¾ÑÑ‚Ð°Ð²ÑŒ Ð»ÑŽÐ±Ð¾Ð¹ SQL-Ð·Ð°Ð¿Ñ€Ð¾Ñ Ñ Ð´Ð¾ÐºÐ°Ð·Ð°Ñ‚ÐµÐ»ÑŒÑÑ‚Ð²Ð¾Ð¼ Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹ Ð¸Ð½Ð´ÐµÐºÑÐ° (`EXPLAIN ANALYZE`), Ð´ÐµÐ¼Ð¾Ð½ÑÑ‚Ñ€Ð¸Ñ€ÑƒÑŽÑ‰Ð¸Ð¼, Ñ‡Ñ‚Ð¾ Ð¸Ð½Ð´ÐµÐºÑ `idx_menu_unique` Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ÑÑ.

## Ð—Ð°Ð´Ð°Ð½Ð¸Ðµ 05 â€” Partial uniqueness for data

| Ð—Ð°Ð´Ð°Ð½Ð¸Ðµ 05: Partial uniqueness for data Ð´Ð°Ð½Ð½Ñ‹Ñ… |                                                                                                                          |
|---------------------------------------|--------------------------------------------------------------------------------------------------------------------------|
| Ð”Ð¸Ñ€ÐµÐºÑ‚Ð¾Ñ€Ð¸Ñ Ð´Ð»Ñ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ Ñ€ÐµÑˆÐµÐ½Ð¸Ð¹       | ex05                                                                                                                     |
| Ð¤Ð°Ð¹Ð»Ñ‹ Ð´Ð»Ñ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸                    | `day05_ex05.sql`                                                                                 |
| **Ð Ð°Ð·Ñ€ÐµÑˆÐµÐ½Ð¾**                         |                                                                                                                          |
| Ð¯Ð·Ñ‹Ðº                                  | ANSI SQL                                                                                              |

Ð¡Ð¾Ð·Ð´Ð°Ð¹ Ñ‡Ð°ÑÑ‚Ð¸Ñ‡Ð½Ð¾ ÑƒÐ½Ð¸ÐºÐ°Ð»ÑŒÐ½Ñ‹Ð¹ B-Tree index Ñ Ð¸Ð¼ÐµÐ½ÐµÐ¼ `idx_person_order_order_date` Ð½Ð° Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ðµ `person_order` Ð´Ð»Ñ Ð°Ñ‚Ñ€Ð¸Ð±ÑƒÑ‚Ð¾Ð² `person_id` Ð¸ `menu_id` Ñ Ñ‡Ð°ÑÑ‚Ð¸Ñ‡Ð½Ð¾Ð¹ ÑƒÐ½Ð¸ÐºÐ°Ð»ÑŒÐ½Ð¾ÑÑ‚ÑŒÑŽ Ð¿Ð¾ ÑÑ‚Ð¾Ð»Ð±Ñ†Ñƒ `order_date` Ð´Ð»Ñ Ð´Ð°Ñ‚Ñ‹ '2022-01-01'.

ÐšÐ¾Ð¼Ð°Ð½Ð´Ð° `EXPLAIN ANALYZE` Ð´Ð¾Ð»Ð¶Ð½Ð° Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°Ñ‚ÑŒ ÑÐ»ÐµÐ´ÑƒÑŽÑ‰Ð¸Ð¹ ÑˆÐ°Ð±Ð»Ð¾Ð½:

    Index Only Scan using idx_person_order_order_date on person_order â€¦

## Ð—Ð°Ð´Ð°Ð½Ð¸Ðµ 06 â€” Letâ€™s make performance improvement

| Ð—Ð°Ð´Ð°Ð½Ð¸Ðµ 06: Letâ€™s make performance improvement |                                                                                                                          |
|---------------------------------------|--------------------------------------------------------------------------------------------------------------------------|
| Ð”Ð¸Ñ€ÐµÐºÑ‚Ð¾Ñ€Ð¸Ñ Ð´Ð»Ñ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ Ñ€ÐµÑˆÐµÐ½Ð¸Ð¹       | ex06                                                                                                                     |
| Ð¤Ð°Ð¹Ð»Ñ‹ Ð´Ð»Ñ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸                    | `day05_ex06.sql`                                                                                 |
| **Ð Ð°Ð·Ñ€ÐµÑˆÐµÐ½Ð¾**                         |                                                                                                                          |
| Ð¯Ð·Ñ‹Ðº                                  | ANSI SQL                                                                                              |

ÐŸÑ€Ð¾Ð°Ð½Ð°Ð»Ð¸Ð·Ð¸Ñ€ÑƒÐ¹ Ð¿Ñ€Ð¸Ð²ÐµÐ´ÐµÐ½Ð½Ñ‹Ð¹ Ð½Ð¸Ð¶Ðµ SQL-Ð·Ð°Ð¿Ñ€Ð¾Ñ Ñ Ñ‚ÐµÑ…Ð½Ð¸Ñ‡ÐµÑÐºÐ¾Ð¹ Ñ‚Ð¾Ñ‡ÐºÐ¸ Ð·Ñ€ÐµÐ½Ð¸Ñ (Ð½Ðµ Ð¾Ð±Ñ€Ð°Ñ‰Ð°Ð¹ Ð²Ð½Ð¸Ð¼Ð°Ð½Ð¸Ñ Ð½Ð° Ð»Ð¾Ð³Ð¸Ñ‡ÐµÑÐºÑƒÑŽ ÑÐ¾ÑÑ‚Ð°Ð²Ð»ÑÑŽÑ‰ÑƒÑŽ ÑÑ‚Ð¾Ð³Ð¾ Ð¾Ð¿ÐµÑ€Ð°Ñ‚Ð¾Ñ€Ð°).

    SELECT
        m.pizza_name AS pizza_name,
        max(rating) OVER (PARTITION BY rating ORDER BY rating ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING) AS k
    FROM  menu m
    INNER JOIN pizzeria pz ON m.pizzeria_id = pz.id
    ORDER BY 1,2;

Ð¡Ð¾Ð·Ð´Ð°Ð¹ Ð½Ð¾Ð²Ñ‹Ð¹ B-Tree index Ñ Ð¸Ð¼ÐµÐ½ÐµÐ¼ `idx_1`, ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ð¹ Ð´Ð¾Ð»Ð¶ÐµÐ½ ÑƒÐ»ÑƒÑ‡ÑˆÐ¸Ñ‚ÑŒ Ð¿Ð¾ÐºÐ°Ð·Ð°Ñ‚ÐµÐ»ÑŒ Â«Ð’Ñ€ÐµÐ¼Ñ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸ÑÂ» (Execution Time) ÑÑ‚Ð¾Ð³Ð¾ Ð·Ð°Ð¿Ñ€Ð¾ÑÐ°. ÐŸÑ€ÐµÐ´Ð¾ÑÑ‚Ð°Ð²ÑŒ Ð´Ð¾ÐºÐ°Ð·Ð°Ñ‚ÐµÐ»ÑŒÑÑ‚Ð²Ð° ÑƒÐ»ÑƒÑ‡ÑˆÐµÐ½Ð¸Ñ Ñ Ð¿Ð¾Ð¼Ð¾Ñ‰ÑŒÑŽ ÐºÐ¾Ð¼Ð°Ð½Ð´Ñ‹ `EXPLAIN ANALYZE`.

**ÐŸÐ¾Ð´ÑÐºÐ°Ð·ÐºÐ°**: Ð­Ñ‚Ð¾ Ð·Ð°Ð´Ð°Ð½Ð¸Ðµ Ð¿Ð¾Ñ…Ð¾Ð¶Ðµ Ð½Ð° Ð·Ð°Ð´Ð°Ñ‡Ñƒ "Ð¼ÐµÑ‚Ð¾Ð´Ð° Ð³Ñ€ÑƒÐ±Ð¾Ð¹ ÑÐ¸Ð»Ñ‹" Ð´Ð»Ñ Ð¿Ð¾Ð¸ÑÐºÐ° Ñ…Ð¾Ñ€Ð¾ÑˆÐµÐ³Ð¾ Ð¿Ð¾ÐºÑ€Ñ‹Ð²Ð°ÑŽÑ‰ÐµÐ³Ð¾ Ð¸Ð½Ð´ÐµÐºÑÐ° (covering index), Ð¿Ð¾ÑÑ‚Ð¾Ð¼Ñƒ Ð¿ÐµÑ€ÐµÐ´ ÐºÐ°Ð¶Ð´Ñ‹Ð¼ Ð½Ð¾Ð²Ñ‹Ð¼ Ñ‚ÐµÑÑ‚Ð¾Ð¼ ÑƒÐ´Ð°Ð»ÑÐ¹ Ð¸Ð½Ð´ÐµÐºÑ `idx_1`.

ÐŸÑ€Ð¸Ð¼ÐµÑ€ Ð¼Ð¾ÐµÐ³Ð¾ ÑƒÐ»ÑƒÑ‡ÑˆÐµÐ½Ð¸Ñ:

**Ð”Ð¾**:

    Sort  (cost=26.08..26.13 rows=19 width=53) (actual time=0.247..0.254 rows=19 loops=1)
    "  Sort Key: m.pizza_name, (max(pz.rating) OVER (?))"
    Sort Method: quicksort  Memory: 26kB
    ->  WindowAgg  (cost=25.30..25.68 rows=19 width=53) (actual time=0.110..0.182 rows=19 loops=1)
            ->  Sort  (cost=25.30..25.35 rows=19 width=21) (actual time=0.088..0.096 rows=19 loops=1)
                Sort Key: pz.rating
                Sort Method: quicksort  Memory: 26kB
                ->  Merge Join  (cost=0.27..24.90 rows=19 width=21) (actual time=0.026..0.060 rows=19 loops=1)
                        Merge Cond: (m.pizzeria_id = pz.id)
                        ->  Index Only Scan using idx_menu_unique on menu m  (cost=0.14..12.42 rows=19 width=22) (actual time=0.013..0.029 rows=19 loops=1)
                            Heap Fetches: 19
                        ->  Index Scan using pizzeria_pkey on pizzeria pz  (cost=0.13..12.22 rows=6 width=15) (actual time=0.005..0.008 rows=6 loops=1)
    Planning Time: 0.711 ms
    Execution Time: 0.338 ms

**ÐŸÐ¾ÑÐ»Ðµ**:

    Sort  (cost=26.28..26.33 rows=19 width=53) (actual time=0.144..0.148 rows=19 loops=1)
    "  Sort Key: m.pizza_name, (max(pz.rating) OVER (?))"
    Sort Method: quicksort  Memory: 26kB
    ->  WindowAgg  (cost=0.27..25.88 rows=19 width=53) (actual time=0.049..0.107 rows=19 loops=1)
            ->  Nested Loop  (cost=0.27..25.54 rows=19 width=21) (actual time=0.022..0.058 rows=19 loops=1)
                ->  Index Scan using idx_1 on â€¦
                ->  Index Only Scan using idx_menu_unique on menu m  (cost=0.14..2.19 rows=3 width=22) (actual time=0.004..0.005 rows=3 loops=6)
    â€¦
    Planning Time: 0.338 ms
    Execution Time: 0.203 ms